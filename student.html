<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–£—á–µ–Ω–∏–∫ - –•–∏–º–∏—è –ö–∞—Ö—É—Ç</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <style>
        /* GLASSMORPHISM STUDENT STYLES */
        :root {
            --glass-bg: rgba(255, 255, 255, 0.08);
            --glass-border: rgba(255, 255, 255, 0.15);
            --glass-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            --primary-glow: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --accent-glow: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            --success-glow: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            --warning-glow: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --danger-glow: linear-gradient(135deg, #ff416c 0%, #ff4b2b 100%);
        }
        
        body {
            font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
            color: white;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            margin: 0;
            position: relative;
            overflow-x: hidden;
        }
        
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 10% 20%, rgba(120, 119, 198, 0.25) 0%, transparent 50%),
                radial-gradient(circle at 90% 80%, rgba(255, 119, 198, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 50% 50%, rgba(120, 219, 255, 0.2) 0%, transparent 50%);
            z-index: -1;
        }
        
        /* GLASS –ö–û–ù–¢–ï–ô–ù–ï–† */
        .student-container {
            width: 100%;
            max-width: 600px;
            background: var(--glass-bg);
            backdrop-filter: blur(30px);
            border-radius: 32px;
            overflow: hidden;
            box-shadow: 
                0 20px 80px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            border: 1px solid var(--glass-border);
            animation: glassFadeIn 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        @keyframes glassFadeIn {
            from {
                opacity: 0;
                transform: translateY(30px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }
        
        /* GLASS –≠–ö–†–ê–ù–´ */
        .screen {
            display: none;
            padding: 50px;
            animation: screenFade 0.4s ease;
        }
        
        @keyframes screenFade {
            from { opacity: 0; transform: translateX(20px); }
            to { opacity: 1; transform: translateX(0); }
        }
        
        .screen.active {
            display: block;
        }
        
        /* GLASS –≠–ö–†–ê–ù –í–•–û–î–ê */
        .login-box {
            text-align: center;
        }
        
        .logo {
            font-size: 100px;
            margin-bottom: 30px;
            display: inline-block;
            background: var(--accent-glow);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: float 4s ease-in-out infinite;
            filter: drop-shadow(0 10px 20px rgba(79, 172, 254, 0.3));
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-15px) rotate(5deg); }
        }
        
        .login-box h1 {
            font-size: 2.8rem;
            margin-bottom: 15px;
            background: var(--primary-glow);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 900;
        }
        
        .subtitle {
            color: rgba(255, 255, 255, 0.8);
            margin-bottom: 50px;
            font-size: 1.2rem;
            line-height: 1.6;
        }
        
        /* GLASS –§–û–†–ú–´ */
        .form-group {
            margin-bottom: 35px;
            text-align: left;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 12px;
            font-weight: 700;
            color: rgba(255, 255, 255, 0.95);
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .form-group input {
            width: 100%;
            padding: 22px 25px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 18px;
            color: white;
            font-size: 1.2rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-family: inherit;
        }
        
        .form-group input:focus {
            outline: none;
            border-color: #4facfe;
            background: rgba(79, 172, 254, 0.15);
            box-shadow: 
                0 0 0 4px rgba(79, 172, 254, 0.1),
                inset 0 0 0 1px rgba(255, 255, 255, 0.1);
            transform: translateY(-2px);
        }
        
        .code-input-container input {
            font-family: 'Courier New', monospace;
            font-size: 1.8rem;
            letter-spacing: 3px;
            text-align: center;
            font-weight: 900;
        }
        
        .code-hint {
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.95rem;
            margin-top: 12px;
            text-align: center;
        }
        
        /* GLASS –ö–ù–û–ü–ö–ò */
        .glass-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            width: 100%;
            padding: 25px;
            font-size: 1.3rem;
            font-weight: 800;
            border: none;
            border-radius: 18px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            margin: 15px 0;
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(10px);
            border: 2px solid transparent;
            color: white;
        }
        
        .glass-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.6s ease;
        }
        
        .glass-btn:hover::before {
            left: 100%;
        }
        
        .btn-join {
            background: linear-gradient(135deg, 
                rgba(79, 172, 254, 0.2) 0%, 
                rgba(0, 242, 254, 0.2) 100%);
            border-color: rgba(79, 172, 254, 0.5);
            box-shadow: 0 15px 40px rgba(79, 172, 254, 0.2);
        }
        
        .btn-leave {
            background: linear-gradient(135deg, 
                rgba(255, 65, 108, 0.2) 0%, 
                rgba(255, 75, 43, 0.2) 100%);
            border-color: rgba(255, 65, 108, 0.5);
            box-shadow: 0 15px 40px rgba(255, 65, 108, 0.2);
        }
        
        .glass-btn:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 25px 60px rgba(0, 0, 0, 0.3);
            border-color: rgba(255, 255, 255, 0.5);
        }
        
        .login-info {
            margin-top: 40px;
            padding: 25px;
            background: rgba(0, 242, 254, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 18px;
            text-align: center;
            color: rgba(255, 255, 255, 0.9);
            font-size: 1rem;
            border: 1px solid rgba(0, 242, 254, 0.3);
        }
        
        /* GLASS –≠–ö–†–ê–ù –û–ñ–ò–î–ê–ù–ò–Ø */
        .waiting-box {
            text-align: center;
        }
        
        .loader {
            width: 90px;
            height: 90px;
            border: 5px solid rgba(255, 255, 255, 0.1);
            border-top: 5px solid #4facfe;
            border-radius: 50%;
            margin: 0 auto 35px;
            animation: spin 1.5s linear infinite;
            box-shadow: 0 0 30px rgba(79, 172, 254, 0.3);
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .waiting-box h2 {
            color: #4facfe;
            margin-bottom: 15px;
            font-size: 2.2rem;
            font-weight: 800;
        }
        
        .user-info {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            padding: 30px;
            border-radius: 24px;
            margin: 40px 0;
            text-align: left;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .info-item {
            display: flex;
            justify-content: space-between;
            padding: 18px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            align-items: center;
        }
        
        .info-item:last-child {
            border-bottom: none;
        }
        
        .info-item span {
            color: rgba(255, 255, 255, 0.7);
            font-size: 1.1rem;
        }
        
        .info-item strong, .info-item code {
            color: #43e97b;
            font-size: 1.4rem;
            font-weight: 900;
            text-shadow: 0 0 10px rgba(67, 233, 123, 0.3);
        }
        
        .room-info {
            margin: 30px 0;
            color: #4facfe;
            font-size: 1.3rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }
        
        /* GLASS –≠–ö–†–ê–ù –í–û–ü–†–û–°–ê */
        .question-box {
            height: 100%;
        }
        
        .question-header {
            background: linear-gradient(135deg, 
                rgba(102, 126, 234, 0.2) 0%, 
                rgba(118, 75, 162, 0.2) 100%);
            padding: 25px 30px;
            border-radius: 24px 24px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 35px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.2);
        }
        
        .question-meta {
            display: flex;
            gap: 25px;
            align-items: center;
        }
        
        .question-type {
            background: rgba(0, 0, 0, 0.2);
            color: white;
            padding: 12px 24px;
            border-radius: 25px;
            font-weight: 900;
            font-size: 1.1rem;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .question-number {
            color: white;
            font-size: 1.4rem;
            font-weight: 900;
        }
        
        .question-content {
            padding: 15px 0;
        }
        
        .question-text {
            font-size: 1.8rem;
            color: white;
            line-height: 1.5;
            margin-bottom: 50px;
            text-align: center;
            padding: 0 15px;
            font-weight: 700;
        }
        
        .options {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
            margin-bottom: 35px;
        }
        
        .option-btn {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            padding: 28px 25px;
            color: white;
            font-size: 1.2rem;
            text-align: left;
            display: flex;
            align-items: center;
            gap: 25px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .option-btn:hover {
            background: rgba(79, 172, 254, 0.2);
            border-color: rgba(79, 172, 254, 0.5);
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 15px 40px rgba(79, 172, 254, 0.2);
        }
        
        .option-btn.selected {
            background: rgba(67, 233, 123, 0.2);
            border-color: rgba(67, 233, 123, 0.5);
            transform: scale(1.03);
            box-shadow: 0 15px 40px rgba(67, 233, 123, 0.2);
        }
        
        .option-letter {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 900;
            font-size: 1.5rem;
            flex-shrink: 0;
            box-shadow: 0 8px 25px rgba(79, 172, 254, 0.3);
        }
        
        .option-btn.selected .option-letter {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
        }
        
        .answer-status {
            text-align: center;
            padding: 25px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border-radius: 18px;
            margin-top: 30px;
            color: #43e97b;
            font-weight: 900;
            font-size: 1.4rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* GLASS –≠–ö–†–ê–ù –†–ï–ó–£–õ–¨–¢–ê–¢–ê */
        .result-box {
            text-align: center;
        }
        
        .result-box h2 {
            color: #4facfe;
            margin-bottom: 40px;
            font-size: 2.2rem;
            font-weight: 900;
        }
        
        .result-content {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(30px);
            border-radius: 28px;
            padding: 40px;
            margin-bottom: 40px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
        }
        
        .next-info {
            color: rgba(255, 255, 255, 0.8);
            font-size: 1.2rem;
        }
        
        .next-info p {
            margin-bottom: 20px;
        }
        
        /* GLASS –ê–î–ê–ü–¢–ò–í–ù–û–°–¢–¨ */
        @media (max-width: 768px) {
            body {
                padding: 15px;
            }
            
            .student-container {
                border-radius: 24px;
            }
            
            .screen {
                padding: 30px;
            }
            
            .logo {
                font-size: 70px;
            }
            
            .login-box h1 {
                font-size: 2.2rem;
            }
            
            .question-text {
                font-size: 1.5rem;
            }
            
            .option-btn {
                padding: 22px 20px;
                font-size: 1.1rem;
            }
            
            .option-letter {
                width: 50px;
                height: 50px;
                font-size: 1.3rem;
            }
        }
        
        @media (max-width: 480px) {
            .screen {
                padding: 25px;
            }
            
            .question-header {
                flex-direction: column;
                gap: 20px;
                text-align: center;
            }
            
            .question-text {
                font-size: 1.3rem;
            }
            
            .option-btn {
                padding: 18px 15px;
            }
            
            .option-letter {
                width: 45px;
                height: 45px;
                font-size: 1.1rem;
            }
            
            .form-group input {
                padding: 18px 20px;
                font-size: 1.1rem;
            }
            
            .glass-btn {
                padding: 20px;
                font-size: 1.1rem;
            }
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ */
        .debug-info {
            position: fixed;
            bottom: 10px;
            left: 10px;
            background: rgba(0,0,0,0.7);
            color: #0f0;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            z-index: 10000;
            max-width: 300px;
            display: none;
        }
        
        .error-message {
            background: rgba(255, 0, 0, 0.2);
            border: 1px solid #ff0000;
            color: #ff6666;
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            text-align: center;
        }
    </style>
</head>
<body class="student-page">
    <!-- –ü–∞–Ω–µ–ª—å –æ—Ç–ª–∞–¥–∫–∏ -->
    <div id="debugPanel" class="debug-info">
        <div>–°—Ç–∞—Ç—É—Å: <span id="debugStatus">–ó–∞–≥—Ä—É–∑–∫–∞...</span></div>
        <div>Firebase: <span id="firebaseStatus">–ü—Ä–æ–≤–µ—Ä–∫–∞...</span></div>
    </div>
    
    <div class="student-container">
        <!-- GLASS –≠–ö–†–ê–ù 1: –í–•–û–î -->
        <div id="joinScreen" class="screen active">
            <div class="login-box">
                <div class="logo">üß™</div>
                <h1>–•–ò–ú–ò–Ø –ö–ê–•–£–¢</h1>
                <p class="subtitle">–ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ –≤–∏–∫—Ç–æ—Ä–∏–Ω–µ –ø–æ —Ö–∏–º–∏–∏. –¢–µ–º–∞: –ö—Ä–µ–º–Ω–∏–π –∏ –µ–≥–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è.</p>
                
                <div class="login-form">
                    <div id="errorContainer"></div>
                    
                    <div class="form-group">
                        <label><i class="fas fa-user"></i> –í–∞—à–µ –∏–º—è:</label>
                        <input type="text" id="playerName" 
                               placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è"
                               maxlength="15"
                               autocomplete="off">
                    </div>
                    
                    <div class="form-group">
                        <label><i class="fas fa-key"></i> –ö–æ–¥ –≤–∏–∫—Ç–æ—Ä–∏–Ω—ã (8 —Ü–∏—Ñ—Ä):</label>
                        <div class="code-input-container">
                            <input type="text" 
                                   id="gameCode" 
                                   placeholder="–í–≤–µ–¥–∏—Ç–µ 8 —Ü–∏—Ñ—Ä"
                                   maxlength="8"
                                   inputmode="numeric"
                                   pattern="[0-9]*"
                                   autocomplete="off">
                            <div class="code-hint">8 —Ü–∏—Ñ—Ä, –Ω–∞–ø—Ä–∏–º–µ—Ä: 12345678</div>
                        </div>
                    </div>
                    
                    <button id="joinButton" class="glass-btn btn-join">
                        <i class="fas fa-gamepad"></i> –ü–û–î–ö–õ–Æ–ß–ò–¢–¨–°–Ø –ö –í–ò–ö–¢–û–†–ò–ù–ï
                    </button>
                    
                    <div class="login-info">
                        <p><i class="fas fa-bullhorn"></i> –ö–æ–¥ –≤–∏–∫—Ç–æ—Ä–∏–Ω—ã –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å –Ω–∞ —ç–∫—Ä–∞–Ω–µ</p>
                        <p><i class="fas fa-mobile-alt"></i> –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–µ–ª–µ—Ñ–æ–Ω –∏–ª–∏ –∫–æ–º–ø—å—é—Ç–µ—Ä –¥–ª—è –æ—Ç–≤–µ—Ç–æ–≤</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- GLASS –≠–ö–†–ê–ù 2: –û–ñ–ò–î–ê–ù–ò–ï -->
        <div id="waitingScreen" class="screen">
            <div class="waiting-box">
                <div class="loader"></div>
                <h2>–û–ñ–ò–î–ê–ù–ò–ï...</h2>
                <p>–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å —Å–∫–æ—Ä–æ –∑–∞–ø—É—Å—Ç–∏—Ç –≤–æ–ø—Ä–æ—Å</p>
                
                <div class="user-info">
                    <div class="info-item">
                        <span>–£—á–∞—Å—Ç–Ω–∏–∫:</span>
                        <strong id="displayName">-</strong>
                    </div>
                    <div class="info-item">
                        <span>–ö–æ–¥ –≤–∏–∫—Ç–æ—Ä–∏–Ω—ã:</span>
                        <code id="displayCode">-</code>
                    </div>
                </div>
                
                <div class="room-info">
                    <p>üë• –£—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –≤ –≤–∏–∫—Ç–æ—Ä–∏–Ω–µ: <span id="roomPlayers" style="color: #43e97b;">1</span></p>
                </div>
                
                <button onclick="leaveGame()" class="glass-btn btn-leave">
                    <i class="fas fa-sign-out-alt"></i> –í–´–ô–¢–ò –ò–ó –í–ò–ö–¢–û–†–ò–ù–´
                </button>
            </div>
        </div>

        <!-- GLASS –≠–ö–†–ê–ù 3: –í–û–ü–†–û–° -->
        <div id="questionScreen" class="screen">
            <div class="question-box">
                <div class="question-header">
                    <div class="question-meta">
                        <span class="question-type" id="questionType">–•–ò–ú–ò–Ø</span>
                        <span class="question-number">–í–æ–ø—Ä–æ—Å <span id="currentQ">1</span>/30</span>
                    </div>
                </div>
                
                <div class="question-content">
                    <div class="question-text" id="questionText">
                        –¢–µ–∫—Å—Ç –≤–æ–ø—Ä–æ—Å–∞ –ø–æ—è–≤–∏—Ç—Å—è –∑–¥–µ—Å—å
                    </div>
                    
                    <div class="options" id="optionsContainer">
                        <!-- –í–∞—Ä–∏–∞–Ω—Ç—ã –∑–∞–≥—Ä—É–∑—è—Ç—Å—è —á–µ—Ä–µ–∑ JS -->
                    </div>
                    
                    <div class="answer-status" id="answerStatus">
                        –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—Ä–∏–∞–Ω—Ç –æ—Ç–≤–µ—Ç–∞
                    </div>
                </div>
            </div>
        </div>

        <!-- GLASS –≠–ö–†–ê–ù 4: –†–ï–ó–£–õ–¨–¢–ê–¢ -->
        <div id="resultScreen" class="screen">
            <div class="result-box">
                <h2>üìä –†–ï–ó–£–õ–¨–¢–ê–¢</h2>
                <div class="result-content" id="resultContent">
                    –ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞...
                </div>
                <div class="next-info">
                    <p>–°–ª–µ–¥—É—é—â–∏–π –≤–æ–ø—Ä–æ—Å —Å–∫–æ—Ä–æ –Ω–∞—á–Ω–µ—Ç—Å—è</p>
                </div>
            </div>
        </div>
    </div>

    <!-- –í—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Firebase (–µ—Å–ª–∏ –≤–Ω–µ—à–Ω–∏–π —Ñ–∞–π–ª –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç) -->
    <script>
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ Firebase
        function checkFirebase() {
            try {
                if (typeof firebase !== 'undefined' && firebase.apps && firebase.apps.length > 0) {
                    console.log("‚úÖ Firebase –∑–∞–≥—Ä—É–∂–µ–Ω");
                    document.getElementById('firebaseStatus').textContent = '‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω';
                    return firebase.database();
                } else {
                    console.log("‚ùå Firebase –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω");
                    document.getElementById('firebaseStatus').textContent = '‚ùå –ù–µ –∑–∞–≥—Ä—É–∂–µ–Ω';
                    return null;
                }
            } catch (error) {
                console.error("–û—à–∏–±–∫–∞ Firebase:", error);
                document.getElementById('firebaseStatus').textContent = '‚ùå –û—à–∏–±–∫–∞: ' + error.message;
                return null;
            }
        }
    </script>

    <script>
        // ============================================
        // –î–ê–ù–ù–´–ï –í–ò–ö–¢–û–†–ò–ù–´
        // ============================================

        const QUIZ_DATA = {
            title: "–ö—Ä–µ–º–Ω–∏–π –∏ –µ–≥–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è",
            questions: [
                {
                    id: "q1",
                    text: "–ö–∞–∫–æ–π —Ö–∏–º–∏—á–µ—Å–∫–∏–π —Å–∏–º–≤–æ–ª —É –∫—Ä–µ–º–Ω–∏—è?",
                    options: ["Si", "S", "Cl", "C"],
                    correct: 0,
                    points: 1,
                    difficulty: "easy",
                    explanation: "Si - —Ö–∏–º–∏—á–µ—Å–∫–∏–π —Å–∏–º–≤–æ–ª –∫—Ä–µ–º–Ω–∏—è (–æ—Ç –ª–∞—Ç. Silicium)."
                },
                {
                    id: "q2",
                    text: "–ö–∞–∫–æ–π –∏–∑ –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–Ω—ã—Ö –æ–∫—Å–∏–¥–æ–≤ –æ–±—Ä–∞–∑—É–µ—Ç –∫—Ä–µ–º–Ω–∏–π?",
                    options: ["SiO", "SiO‚ÇÇ", "Si‚ÇÇO‚ÇÉ", "Si‚ÇÉO‚ÇÑ"],
                    correct: 1,
                    points: 2,
                    difficulty: "medium",
                    explanation: "SiO‚ÇÇ - –¥–∏–æ–∫—Å–∏–¥ –∫—Ä–µ–º–Ω–∏—è, –Ω–∞–∏–±–æ–ª–µ–µ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–Ω–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∫—Ä–µ–º–Ω–∏—è."
                },
                {
                    id: "q3",
                    text: "–ö–∞–∫–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∫—Ä–µ–º–Ω–∏—è –Ω–∞–∑—ã–≤–∞—é—Ç '–±–µ–ª–æ–π —Å–∞–∂–µ–π'?",
                    options: ["–ö–≤–∞—Ä—Ü", "–ê—ç—Ä–æ—Å–∏–ª", "–°–∏–ª–∏–∫–∞–≥–µ–ª—å", "–¢–∞–ª—å–∫"],
                    correct: 1,
                    points: 3,
                    difficulty: "hard",
                    explanation: "–ê—ç—Ä–æ—Å–∏–ª (–¥–∏–æ–∫—Å–∏–¥ –∫—Ä–µ–º–Ω–∏—è) –Ω–∞–∑—ã–≤–∞—é—Ç '–±–µ–ª–æ–π —Å–∞–∂–µ–π' –∏–∑-–∑–∞ –≤–Ω–µ—à–Ω–µ–≥–æ —Å—Ö–æ–¥—Å—Ç–≤–∞."
                },
                {
                    id: "q4",
                    text: "–ö–∞–∫–æ–π –º–∏–Ω–µ—Ä–∞–ª —è–≤–ª—è–µ—Ç—Å—è –æ—Å–Ω–æ–≤–Ω—ã–º –∏—Å—Ç–æ—á–Ω–∏–∫–æ–º –∫—Ä–µ–º–Ω–∏—è?",
                    options: ["–ì–µ–º–∞—Ç–∏—Ç", "–ö–≤–∞—Ä—Ü", "–ö–∞–ª—å—Ü–∏—Ç", "–ì–∞–ª–∏—Ç"],
                    correct: 1,
                    points: 2,
                    difficulty: "medium",
                    explanation: "–ö–≤–∞—Ä—Ü (SiO‚ÇÇ) - –Ω–∞–∏–±–æ–ª–µ–µ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–Ω—ã–π –º–∏–Ω–µ—Ä–∞–ª, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π –∫—Ä–µ–º–Ω–∏–π."
                },
                {
                    id: "q5",
                    text: "–ö–∞–∫ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –∫—Ä–µ–º–Ω–∏—è –ø—Ä–æ–≤–æ–¥–∏—Ç—å —ç–ª–µ–∫—Ç—Ä–∏—á–µ—Å—Ç–≤–æ?",
                    options: ["–°–≤–µ—Ä—Ö–ø—Ä–æ–≤–æ–¥–∏–º–æ—Å—Ç—å", "–ü–æ–ª—É–ø—Ä–æ–≤–æ–¥–∏–º–æ—Å—Ç—å", "–ò–∑–æ–ª—è—Ü–∏—è", "–°–≤–µ—Ä—Ö–∏–∑–æ–ª—è—Ü–∏—è"],
                    correct: 1,
                    points: 2,
                    difficulty: "medium",
                    explanation: "–ö—Ä–µ–º–Ω–∏–π —è–≤–ª—è–µ—Ç—Å—è –ø–æ–ª—É–ø—Ä–æ–≤–æ–¥–Ω–∏–∫–æ–º, —á—Ç–æ –¥–µ–ª–∞–µ—Ç –µ–≥–æ –æ—Å–Ω–æ–≤–Ω—ã–º –º–∞—Ç–µ—Ä–∏–∞–ª–æ–º –≤ —ç–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–µ."
                }
            ]
        };

        // ============================================
        // –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï
        // ============================================

        let currentGameId = null;
        let playerName = null;
        let currentQuestion = null;
        let hasAnswered = false;
        let selectedOption = null;
        let db = null;

        // DOM —ç–ª–µ–º–µ–Ω—Ç—ã
        const joinScreen = document.getElementById('joinScreen');
        const waitingScreen = document.getElementById('waitingScreen');
        const questionScreen = document.getElementById('questionScreen');
        const resultScreen = document.getElementById('resultScreen');
        const playerNameInput = document.getElementById('playerName');
        const gameCodeInput = document.getElementById('gameCode');
        const joinButton = document.getElementById('joinButton');
        const displayName = document.getElementById('displayName');
        const displayCode = document.getElementById('displayCode');
        const roomPlayers = document.getElementById('roomPlayers');
        const questionText = document.getElementById('questionText');
        const optionsContainer = document.getElementById('optionsContainer');
        const answerStatus = document.getElementById('answerStatus');
        const resultContent = document.getElementById('resultContent');
        const currentQ = document.getElementById('currentQ');
        const questionType = document.getElementById('questionType');
        const errorContainer = document.getElementById('errorContainer');
        const debugPanel = document.getElementById('debugPanel');
        const debugStatus = document.getElementById('debugStatus');

        // ============================================
        // –û–°–ù–û–í–ù–´–ï –§–£–ù–ö–¶–ò–ò
        // ============================================

        function showError(message) {
            errorContainer.innerHTML = `
                <div class="error-message">
                    <i class="fas fa-exclamation-triangle"></i> ${message}
                </div>
            `;
            
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∫—Ä—ã—Ç—å —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
            setTimeout(() => {
                errorContainer.innerHTML = '';
            }, 5000);
        }

        function showDebug(message) {
            debugStatus.textContent = message;
            console.log("DEBUG:", message);
        }

        function joinGame() {
            console.log("=== –§–£–ù–ö–¶–ò–Ø joinGame –í–´–ó–í–ê–ù–ê ===");
            
            // –û—á–∏—Å—Ç–∏—Ç—å –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –æ—à–∏–±–∫–∏
            errorContainer.innerHTML = '';
            
            // –ü–æ–ª—É—á–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è
            const name = playerNameInput.value.trim();
            const code = gameCodeInput.value.trim();
            
            showDebug(`–í–≤–æ–¥: –∏–º—è="${name}", –∫–æ–¥="${code}"`);
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–º–µ–Ω–∏
            if (!name || name.length < 2) {
                showError("–í–≤–µ–¥–∏—Ç–µ –∏–º—è (–º–∏–Ω–∏–º—É–º 2 —Å–∏–º–≤–æ–ª–∞)");
                playerNameInput.focus();
                return;
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞
            if (!code || code.length !== 8 || !/^\d{8}$/.test(code)) {
                showError("–í–≤–µ–¥–∏—Ç–µ 8 —Ü–∏—Ñ—Ä –∫–æ–¥–∞ –≤–∏–∫—Ç–æ—Ä–∏–Ω—ã");
                gameCodeInput.focus();
                return;
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Firebase
            db = checkFirebase();
            if (!db) {
                showError("–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Firebase –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é.");
                showDebug("Firebase –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω");
                return;
            }
            
            showDebug("Firebase OK, –ø—Ä–æ–≤–µ—Ä—è—é –≤–∏–∫—Ç–æ—Ä–∏–Ω—É...");
            
            // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
            playerName = name;
            currentGameId = "game_" + code;
            
            // –ü–æ–∫–∞–∑–∞—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏
            const originalText = joinButton.innerHTML;
            joinButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> –ü–û–î–ö–õ–Æ–ß–ï–ù–ò–ï...';
            joinButton.disabled = true;
            
            // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –≤–∏–∫—Ç–æ—Ä–∏–Ω—ã
            db.ref(`games/${currentGameId}`).once('value')
                .then(snapshot => {
                    showDebug("–ü–æ–ª—É—á–µ–Ω –æ—Ç–≤–µ—Ç –æ—Ç Firebase");
                    
                    if (!snapshot.exists()) {
                        showError(`–í–∏–∫—Ç–æ—Ä–∏–Ω–∞ —Å –∫–æ–¥–æ–º ${code} –Ω–µ –Ω–∞–π–¥–µ–Ω–∞!`);
                        joinButton.innerHTML = originalText;
                        joinButton.disabled = false;
                        showDebug("–í–∏–∫—Ç–æ—Ä–∏–Ω–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞");
                        return;
                    }
                    
                    const game = snapshot.val();
                    showDebug(`–°—Ç–∞—Ç—É—Å –≤–∏–∫—Ç–æ—Ä–∏–Ω—ã: ${game.status || '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}`);
                    
                    // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
                    if (game.status === "finished") {
                        showError("–≠—Ç–∞ –≤–∏–∫—Ç–æ—Ä–∏–Ω–∞ —É–∂–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∞");
                        joinButton.innerHTML = originalText;
                        joinButton.disabled = false;
                        return;
                    }
                    
                    // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–º—è –∏–≥—Ä–æ–∫–∞
                    if (game.players && game.players[name]) {
                        showError("–£—á–∞—Å—Ç–Ω–∏–∫ —Å —Ç–∞–∫–∏–º –∏–º–µ–Ω–µ–º —É–∂–µ –µ—Å—Ç—å –≤ –≤–∏–∫—Ç–æ—Ä–∏–Ω–µ!");
                        joinButton.innerHTML = originalText;
                        joinButton.disabled = false;
                        return;
                    }
                    
                    // –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –∏–≥—Ä–æ–∫–∞
                    showDebug("–†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É—é –∏–≥—Ä–æ–∫–∞...");
                    const playerData = {
                        name: name,
                        joined: Date.now(),
                        score: 0,
                        device: /Mobi|Android/i.test(navigator.userAgent) ? "üì± –¢–µ–ª–µ—Ñ–æ–Ω" : "üíª –ö–æ–º–ø—å—é—Ç–µ—Ä"
                    };
                    
                    return db.ref(`games/${currentGameId}/players/${name}`).set(playerData);
                })
                .then(() => {
                    if (!playerName) return; // –ï—Å–ª–∏ –±—ã–ª–∞ –æ—à–∏–±–∫–∞ —Ä–∞–Ω–µ–µ
                    
                    showDebug("–ò–≥—Ä–æ–∫ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω");
                    
                    // –û–±–Ω–æ–≤–∏—Ç—å UI
                    displayName.textContent = playerName;
                    displayCode.textContent = code;
                    
                    // –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —ç–∫—Ä–∞–Ω
                    switchScreen('waiting');
                    
                    // –ù–∞—á–∞—Ç—å –ø—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏–µ
                    listenToGame();
                    
                    // –ü–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
                    showNotification(`–ü–æ–¥–∫–ª—é—á–µ–Ω–æ –∫–∞–∫ ${playerName}`, "success");
                    showDebug("–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ");
                })
                .catch(error => {
                    console.error("–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:", error);
                    showError(`–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: ${error.message}`);
                    joinButton.innerHTML = originalText;
                    joinButton.disabled = false;
                    showDebug(`–û—à–∏–±–∫–∞: ${error.message}`);
                });
        }

        function listenToGame() {
            if (!currentGameId || !db) {
                showDebug("–û—à–∏–±–∫–∞: –Ω–µ—Ç gameId –∏–ª–∏ db");
                return;
            }
            
            showDebug(`–ù–∞—á–∏–Ω–∞—é —Å–ª—É—à–∞—Ç—å –≤–∏–∫—Ç–æ—Ä–∏–Ω—É: ${currentGameId}`);
            
            const gameRef = db.ref(`games/${currentGameId}`);
            
            gameRef.on('value', snapshot => {
                const game = snapshot.val();
                if (!game) {
                    showDebug("–í–∏–∫—Ç–æ—Ä–∏–Ω–∞ —É–¥–∞–ª–µ–Ω–∞");
                    showNotification("–í–∏–∫—Ç–æ—Ä–∏–Ω–∞ –±—ã–ª–∞ —É–¥–∞–ª–µ–Ω–∞", "info");
                    leaveGame();
                    return;
                }
                
                // –û–±–Ω–æ–≤–∏—Ç—å —Å—á–µ—Ç—á–∏–∫ –∏–≥—Ä–æ–∫–æ–≤
                if (game.players) {
                    const playerCount = Object.keys(game.players).length;
                    roomPlayers.textContent = playerCount;
                }
                
                const currentQuestionId = game.currentQuestion;
                
                switch (game.status) {
                    case "lobby":
                    case "waiting":
                        handleLobby();
                        break;
                        
                    case "question_active":
                        if (currentQuestionId) {
                            handleQuestionActive(game, currentQuestionId);
                        }
                        break;
                        
                    case "showing_results":
                        handleShowingResults(game, currentQuestionId);
                        break;
                        
                    case "finished":
                        handleGameFinished();
                        break;
                }
            }, error => {
                console.error("–û—à–∏–±–∫–∞ —Å–ª—É—à–∞—Ç–µ–ª—è:", error);
                showDebug(`–û—à–∏–±–∫–∞ —Å–ª—É—à–∞—Ç–µ–ª—è: ${error.message}`);
            });
        }

        function handleLobby() {
            if (!waitingScreen.classList.contains('active')) {
                switchScreen('waiting');
            }
            
            hasAnswered = false;
            selectedOption = null;
        }

        function handleQuestionActive(game, questionId) {
            currentQuestion = QUIZ_DATA.questions.find(q => q.id === questionId);
            if (!currentQuestion) {
                showDebug(`–í–æ–ø—Ä–æ—Å ${questionId} –Ω–µ –Ω–∞–π–¥–µ–Ω`);
                return;
            }
            
            hasAnswered = false;
            selectedOption = null;
            
            switchScreen('question');
            displayQuestion(currentQuestion);
        }

        function displayQuestion(question) {
            const questionIndex = QUIZ_DATA.questions.findIndex(q => q.id === question.id) + 1;
            currentQ.textContent = questionIndex;
            
            // –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ç–∏–ø —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
            const difficultyColors = {
                easy: '#43e97b',
                medium: '#f093fb',
                hard: '#ff416c'
            };
            
            questionType.textContent = question.difficulty === 'easy' ? '–õ–Å–ì–ö–ò–ô' : 
                                     question.difficulty === 'medium' ? '–°–†–ï–î–ù–ò–ô' : '–°–õ–û–ñ–ù–´–ô';
            questionType.style.borderColor = difficultyColors[question.difficulty];
            
            questionText.textContent = question.text;
            
            // –û—á–∏—Å—Ç–∏—Ç—å –∏ –¥–æ–±–∞–≤–∏—Ç—å –≤–∞—Ä–∏–∞–Ω—Ç—ã
            optionsContainer.innerHTML = '';
            question.options.forEach((option, index) => {
                const button = document.createElement('button');
                button.className = 'option-btn';
                button.innerHTML = `
                    <span class="option-letter">${String.fromCharCode(65 + index)}</span>
                    <span class="option-text">${option}</span>
                `;
                button.onclick = () => selectAnswer(index, button);
                optionsContainer.appendChild(button);
            });
            
            answerStatus.textContent = "–í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—Ä–∏–∞–Ω—Ç –æ—Ç–≤–µ—Ç–∞";
            answerStatus.style.color = "#4facfe";
        }

        function selectAnswer(answerIndex, buttonElement) {
            if (hasAnswered || !currentQuestion || !currentGameId || !playerName || !db) return;
            
            selectedOption = answerIndex;
            
            // –í—ã–¥–µ–ª–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç
            document.querySelectorAll('.option-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            
            buttonElement.classList.add('selected');
            
            submitAnswer(answerIndex);
        }

        function submitAnswer(answerIndex) {
            if (hasAnswered) return;
            
            hasAnswered = true;
            
            // –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –∫–Ω–æ–ø–∫–∏
            document.querySelectorAll('.option-btn').forEach(btn => {
                btn.disabled = true;
            });
            
            // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å
            const isCorrect = (answerIndex === currentQuestion.correct);
            
            const answerData = {
                answerIndex: answerIndex,
                isCorrect: isCorrect,
                timestamp: Date.now()
            };
            
            db.ref(`games/${currentGameId}/answers/${currentQuestion.id}/${playerName}`).set(answerData)
                .then(() => {
                    if (isCorrect) {
                        answerStatus.innerHTML = '<i class="fas fa-check-circle"></i> –ü—Ä–∞–≤–∏–ª—å–Ω–æ!';
                        answerStatus.style.color = '#43e97b';
                        
                        // –û–±–Ω–æ–≤–∏—Ç—å —Å—á–µ—Ç
                        db.ref(`games/${currentGameId}/players/${playerName}/score`).transaction(score => {
                            return (score || 0) + (currentQuestion.points || 1);
                        });
                    } else {
                        answerStatus.innerHTML = '<i class="fas fa-times-circle"></i> –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ!';
                        answerStatus.style.color = '#ff416c';
                    }
                })
                .catch(error => {
                    answerStatus.innerHTML = '<i class="fas fa-exclamation-triangle"></i> –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏';
                    answerStatus.style.color = '#f093fb';
                });
        }

        function handleShowingResults(game, questionId) {
            if (!currentQuestion || currentQuestion.id !== questionId) {
                currentQuestion = QUIZ_DATA.questions.find(q => q.id === questionId);
            }
            
            if (!currentQuestion) return;
            
            switchScreen('result');
            
            db.ref(`games/${currentGameId}/answers/${currentQuestion.id}/${playerName}`).once('value')
                .then(snapshot => {
                    const userAnswer = snapshot.val();
                    showResult(userAnswer, currentQuestion);
                })
                .catch(() => {
                    showResult(null, currentQuestion);
                });
        }

        function showResult(userAnswer, question) {
            let resultHTML = '';
            const correctAnswerText = question.options[question.correct];
            
            if (userAnswer && userAnswer.answerIndex >= 0) {
                const isCorrect = userAnswer.isCorrect;
                const userAnswerText = question.options[userAnswer.answerIndex];
                
                resultHTML = `
                    <div style="color: ${isCorrect ? '#43e97b' : '#ff416c'}; font-size: 2rem; margin-bottom: 30px; font-weight: 900;">
                        <i class="fas ${isCorrect ? 'fa-check-circle' : 'fa-times-circle'}"></i>
                        ${isCorrect ? '–ü–†–ê–í–ò–õ–¨–ù–û!' : '–ù–ï–ü–†–ê–í–ò–õ–¨–ù–û'}
                    </div>
                    <div style="background: rgba(255,255,255,0.08); padding: 25px; border-radius: 18px; margin: 20px 0; border: 1px solid rgba(255,255,255,0.2);">
                        <div style="color: rgba(255,255,255,0.7); margin-bottom: 10px; font-size: 1.1rem;">–í–∞—à –æ—Ç–≤–µ—Ç:</div>
                        <div style="color: white; font-size: 1.5rem; font-weight: 700;">${userAnswerText}</div>
                    </div>
                    <div style="background: rgba(67, 233, 123, 0.1); padding: 25px; border-radius: 18px; margin: 20px 0; border: 1px solid rgba(67, 233, 123, 0.3);">
                        <div style="color: rgba(255,255,255,0.7); margin-bottom: 10px; font-size: 1.1rem;">–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç:</div>
                        <div style="color: #43e97b; font-size: 1.5rem; font-weight: 900;">${correctAnswerText}</div>
                    </div>
                    <div style="margin-top: 30px; padding-top: 25px; border-top: 1px solid rgba(255,255,255,0.1);">
                        <div style="color: rgba(255,255,255,0.8); font-style: italic; font-size: 1.2rem; line-height: 1.5;">${question.explanation}</div>
                    </div>
                `;
            } else {
                resultHTML = `
                    <div style="color: #f093fb; font-size: 2rem; margin-bottom: 30px; font-weight: 900;">
                        <i class="fas fa-clock"></i> –í–´ –ù–ï –£–°–ü–ï–õ–ò –û–¢–í–ï–¢–ò–¢–¨
                    </div>
                    <div style="background: rgba(67, 233, 123, 0.1); padding: 25px; border-radius: 18px; margin: 20px 0; border: 1px solid rgba(67, 233, 123, 0.3);">
                        <div style="color: rgba(255,255,255,0.7); margin-bottom: 10px; font-size: 1.1rem;">–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç:</div>
                        <div style="color: #43e97b; font-size: 1.5rem; font-weight: 900;">${correctAnswerText}</div>
                    </div>
                    <div style="margin-top: 30px; padding-top: 25px; border-top: 1px solid rgba(255,255,255,0.1);">
                        <div style="color: rgba(255,255,255,0.8); font-style: italic; font-size: 1.2rem; line-height: 1.5;">${question.explanation}</div>
                    </div>
                `;
            }
            
            resultContent.innerHTML = resultHTML;
        }

        function handleGameFinished() {
            switchScreen('result');
            
            db.ref(`games/${currentGameId}/players/${playerName}`).once('value')
                .then(snapshot => {
                    const playerData = snapshot.val();
                    
                    resultContent.innerHTML = `
                        <div style="text-align: center;">
                            <div style="font-size: 2.5rem; color: #4facfe; margin-bottom: 30px; font-weight: 900;">
                                <i class="fas fa-flag-checkered"></i> –í–ò–ö–¢–û–†–ò–ù–ê –ó–ê–í–ï–†–®–ï–ù–ê
                            </div>
                            <div style="background: rgba(255,255,255,0.08); padding: 35px; border-radius: 24px; margin: 30px 0; border: 2px solid rgba(79, 172, 254, 0.3);">
                                <div style="color: #43e97b; font-size: 3.5rem; margin-bottom: 15px; font-weight: 900; text-shadow: 0 0 20px rgba(67, 233, 123, 0.3);">${playerData.score || 0} –æ—á–∫–æ–≤</div>
                                <div style="color: rgba(255,255,255,0.8); font-size: 1.3rem;">–í–∞—à —Ñ–∏–Ω–∞–ª—å–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç</div>
                            </div>
                            <button onclick="location.reload()" class="glass-btn btn-join" style="margin-top: 20px;">
                                <i class="fas fa-redo"></i> –ù–ê–ß–ê–¢–¨ –ó–ê–ù–û–í–û
                            </button>
                        </div>
                    `;
                });
        }

        function leaveGame() {
            console.log("–í—ã—Ö–æ–∂—É –∏–∑ –∏–≥—Ä—ã...");
            
            if (currentGameId && playerName && db) {
                try {
                    db.ref(`games/${currentGameId}/players/${playerName}`).remove();
                } catch (e) {
                    console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ:", e);
                }
            }
            
            resetGameState();
            switchScreen('join');
        }

        function resetGameState() {
            currentGameId = null;
            playerName = null;
            currentQuestion = null;
            hasAnswered = false;
            selectedOption = null;
            playerNameInput.value = '';
            gameCodeInput.value = '';
        }

        function switchScreen(screenName) {
            [joinScreen, waitingScreen, questionScreen, resultScreen].forEach(screen => {
                screen.classList.remove('active');
            });
            
            switch(screenName) {
                case 'join':
                    joinScreen.classList.add('active');
                    break;
                case 'waiting':
                    waitingScreen.classList.add('active');
                    break;
                case 'question':
                    questionScreen.classList.add('active');
                    break;
                case 'result':
                    resultScreen.classList.add('active');
                    break;
            }
        }

        function showNotification(message, type = "info") {
            const colors = {
                success: '#43e97b',
                error: '#ff416c',
                warning: '#f093fb',
                info: '#4facfe'
            };
            
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: rgba(255, 255, 255, 0.1);
                backdrop-filter: blur(30px);
                border: 1px solid ${colors[type]}40;
                color: white;
                padding: 18px 28px;
                border-radius: 18px;
                font-weight: 700;
                z-index: 10000;
                animation: slideIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
                box-shadow: 0 15px 50px rgba(0,0,0,0.2);
                display: flex;
                align-items: center;
                gap: 12px;
                max-width: 350px;
                border-left: 4px solid ${colors[type]};
            `;
            notification.innerHTML = `
                <span style="font-size: 1.3rem;">${type === 'success' ? '‚úÖ' : type === 'error' ? '‚ùå' : type === 'warning' ? '‚ö†Ô∏è' : '‚ÑπÔ∏è'}</span>
                <span>${message}</span>
            `;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.4s cubic-bezier(0.4, 0, 0.2, 1)';
                setTimeout(() => {
                    if (notification.parentNode) {
                        document.body.removeChild(notification);
                    }
                }, 400);
            }, 3000);
        }

        // –î–æ–±–∞–≤–∏—Ç—å —Å—Ç–∏–ª–∏ –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–π
        const notificationStyle = document.createElement('style');
        notificationStyle.textContent = `
            @keyframes slideIn {
                from {
                    transform: translateX(100%);
                    opacity: 0;
                }
                to {
                    transform: translateX(0);
                    opacity: 1;
                }
            }
            
            @keyframes slideOut {
                from {
                    transform: translateX(0);
                    opacity: 1;
                }
                to {
                    transform: translateX(100%);
                    opacity: 0;
                }
            }
        `;
        document.head.appendChild(notificationStyle);

        // ============================================
        // –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø
        // ============================================

        document.addEventListener('DOMContentLoaded', function() {
            console.log("=== –ü–†–ò–õ–û–ñ–ï–ù–ò–ï –ó–ê–ì–†–£–ñ–ï–ù–û ===");
            
            // –ü–æ–∫–∞–∑–∞—Ç—å –ø–∞–Ω–µ–ª—å –æ—Ç–ª–∞–¥–∫–∏ –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ Ctrl+Shift+D
            document.addEventListener('keydown', function(e) {
                if (e.ctrlKey && e.shiftKey && e.key === 'D') {
                    debugPanel.style.display = debugPanel.style.display === 'none' ? 'block' : 'none';
                }
            });
            
            // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Firebase
            setTimeout(() => {
                db = checkFirebase();
                if (db) {
                    showDebug("–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–æ");
                } else {
                    showDebug("Firebase –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω");
                }
            }, 1000);
            
            // –ù–∞–∑–Ω–∞—á–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–µ
            joinButton.addEventListener('click', joinGame);
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ Enter
            playerNameInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    gameCodeInput.focus();
                }
            });
            
            gameCodeInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    joinGame();
                }
            });
            
            // –í–∞–ª–∏–¥–∞—Ü–∏—è –≤–≤–æ–¥–∞
            gameCodeInput.addEventListener('input', function() {
                this.value = this.value.replace(/\D/g, '');
                if (this.value.length > 8) {
                    this.value = this.value.substring(0, 8);
                }
            });
            
            playerNameInput.addEventListener('input', function() {
                if (this.value.length > 15) {
                    this.value = this.value.substring(0, 15);
                }
            });
            
            // –ê–≤—Ç–æ—Ñ–æ–∫—É—Å
            playerNameInput.focus();
            
            showDebug("–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞");
        });

        // –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
        window.joinGame = joinGame;
        window.leaveGame = leaveGame;
    </script>
</body>
</html>
