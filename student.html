<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–£—á–µ–Ω–∏–∫ - –•–∏–º–∏—è –ö–∞—Ö—É—Ç</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <style>
        /* –°–ë–†–û–° –°–¢–ò–õ–ï–ô */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #1a1a2e;
            color: white;
            min-height: 100vh;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        /* –û–°–ù–û–í–ù–û–ô –ö–û–ù–¢–ï–ô–ù–ï–† */
        .container {
            width: 100%;
            max-width: 500px;
            background: #16213e;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }
        
        /* –≠–ö–†–ê–ù–´ */
        .screen {
            padding: 30px;
            display: none;
        }
        
        .screen.active {
            display: block;
        }
        
        /* –ó–ê–ì–û–õ–û–í–û–ö */
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .logo {
            font-size: 60px;
            margin-bottom: 20px;
            color: #4facfe;
        }
        
        h1 {
            font-size: 2rem;
            color: white;
            margin-bottom: 10px;
        }
        
        .subtitle {
            color: #a0a0c0;
            font-size: 1rem;
            line-height: 1.5;
        }
        
        /* –§–û–†–ú–´ */
        .form-group {
            margin-bottom: 25px;
        }
        
        label {
            display: block;
            margin-bottom: 10px;
            color: white;
            font-weight: 600;
        }
        
        input {
            width: 100%;
            padding: 16px 20px;
            background: #0f3460;
            border: 2px solid #2d4263;
            border-radius: 12px;
            color: white;
            font-size: 1.1rem;
            font-family: inherit;
        }
        
        input:focus {
            outline: none;
            border-color: #4facfe;
        }
        
        #gameCode {
            font-family: 'Courier New', monospace;
            font-size: 1.4rem;
            letter-spacing: 2px;
            text-align: center;
            font-weight: bold;
        }
        
        /* –ö–ù–û–ü–ö–ò */
        .btn {
            width: 100%;
            padding: 18px;
            font-size: 1.1rem;
            font-weight: 600;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            margin: 20px 0;
            color: white;
        }
        
        .btn:active {
            transform: scale(0.98);
        }
        
        .btn-primary {
            background: #4facfe;
        }
        
        .btn-primary:hover {
            background: #2d9cfe;
        }
        
        .btn-danger {
            background: #ff416c;
        }
        
        .btn-danger:hover {
            background: #ff2b5c;
        }
        
        /* –ò–ù–§–û –ë–õ–û–ö */
        .info-box {
            background: #0f3460;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            border-left: 4px solid #4facfe;
        }
        
        .info-item {
            padding: 12px 0;
            border-bottom: 1px solid #2d4263;
            display: flex;
            justify-content: space-between;
        }
        
        .info-item:last-child {
            border-bottom: none;
        }
        
        /* –í–û–ü–†–û–° */
        .question-header {
            background: #0f3460;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .question-text {
            font-size: 1.4rem;
            line-height: 1.5;
            margin: 25px 0;
            text-align: center;
            font-weight: 600;
        }
        
        /* –û–¢–í–ï–¢–´ */
        .options {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin: 30px 0;
        }
        
        .option {
            background: #0f3460;
            border: 2px solid #2d4263;
            border-radius: 12px;
            padding: 18px;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 20px;
            transition: all 0.2s;
        }
        
        .option:active {
            background: #1e4a8a;
        }
        
        .option.selected {
            background: #1e4a8a;
            border-color: #4facfe;
        }
        
        .option-letter {
            width: 40px;
            height: 40px;
            background: #4facfe;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            flex-shrink: 0;
        }
        
        .option.selected .option-letter {
            background: #2d9cfe;
        }
        
        /* –°–¢–ê–¢–£–° */
        .status {
            background: #0f3460;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            font-size: 1.2rem;
            font-weight: 600;
            margin-top: 20px;
        }
        
        .status.correct {
            background: #2e8b57;
        }
        
        .status.wrong {
            background: #dc3545;
        }
        
        /* –õ–û–ê–î–ï–† */
        .loader {
            width: 50px;
            height: 50px;
            border: 4px solid #2d4263;
            border-top: 4px solid #4facfe;
            border-radius: 50%;
            margin: 30px auto;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* –û–®–ò–ë–ö–ò */
        .error {
            background: #dc3545;
            color: white;
            padding: 12px;
            border-radius: 8px;
            margin: 10px 0;
            text-align: center;
            font-weight: 600;
        }
        
        /* –ê–î–ê–ü–¢–ò–í–ù–û–°–¢–¨ */
        @media (max-width: 600px) {
            body {
                padding: 10px;
            }
            
            .screen {
                padding: 20px;
            }
            
            h1 {
                font-size: 1.6rem;
            }
            
            .question-text {
                font-size: 1.2rem;
            }
            
            .option {
                padding: 15px;
            }
            
            .btn {
                padding: 16px;
            }
        }
        
        @media (max-width: 400px) {
            .logo {
                font-size: 50px;
            }
            
            h1 {
                font-size: 1.4rem;
            }
            
            .question-header {
                flex-direction: column;
                gap: 10px;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- –≠–ö–†–ê–ù –í–•–û–î–ê -->
        <div id="joinScreen" class="screen active">
            <div class="header">
                <div class="logo">üß™</div>
                <h1>–•–∏–º–∏—è –ö–∞—Ö—É—Ç</h1>
                <p class="subtitle">–ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ –≤–∏–∫—Ç–æ—Ä–∏–Ω–µ –ø–æ —Ö–∏–º–∏–∏. –¢–µ–º–∞: –ö—Ä–µ–º–Ω–∏–π –∏ –µ–≥–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è.</p>
            </div>
            
            <div id="errorContainer"></div>
            
            <div class="form-group">
                <label>–í–∞—à–µ –∏–º—è:</label>
                <input type="text" id="playerName" 
                       placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è"
                       maxlength="15"
                       autocomplete="off">
            </div>
            
            <div class="form-group">
                <label>–ö–æ–¥ –≤–∏–∫—Ç–æ—Ä–∏–Ω—ã:</label>
                <input type="text" 
                       id="gameCode" 
                       placeholder="8 —Ü–∏—Ñ—Ä"
                       maxlength="8"
                       inputmode="numeric"
                       pattern="[0-9]*"
                       autocomplete="off">
            </div>
            
            <button id="joinButton" class="btn btn-primary">
                <i class="fas fa-gamepad"></i> –ü–û–î–ö–õ–Æ–ß–ò–¢–¨–°–Ø
            </button>
            
            <div class="info-box">
                <p><i class="fas fa-info-circle"></i> –ö–æ–¥ –≤–∏–∫—Ç–æ—Ä–∏–Ω—ã –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å –Ω–∞ —ç–∫—Ä–∞–Ω–µ.</p>
                <p><i class="fas fa-mobile-alt"></i> –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–µ–ª–µ—Ñ–æ–Ω –∏–ª–∏ –∫–æ–º–ø—å—é—Ç–µ—Ä –¥–ª—è –æ—Ç–≤–µ—Ç–æ–≤.</p>
            </div>
        </div>

        <!-- –≠–ö–†–ê–ù –û–ñ–ò–î–ê–ù–ò–Ø -->
        <div id="waitingScreen" class="screen">
            <div class="header">
                <div class="loader"></div>
                <h2>–û–ñ–ò–î–ê–ù–ò–ï...</h2>
                <p class="subtitle">–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å —Å–∫–æ—Ä–æ –∑–∞–ø—É—Å—Ç–∏—Ç –≤–æ–ø—Ä–æ—Å</p>
            </div>
            
            <div class="info-box">
                <div class="info-item">
                    <span>–£—á–∞—Å—Ç–Ω–∏–∫:</span>
                    <strong id="displayName">-</strong>
                </div>
                <div class="info-item">
                    <span>–ö–æ–¥ –≤–∏–∫—Ç–æ—Ä–∏–Ω—ã:</span>
                    <strong id="displayCode">-</strong>
                </div>
                <div class="info-item">
                    <span>–í–∞—à–∏ –æ—á–∫–∏:</span>
                    <strong id="displayScore">0</strong>
                </div>
                <div class="info-item">
                    <span>–ò–≥—Ä–æ–∫–æ–≤ –æ–Ω–ª–∞–π–Ω:</span>
                    <strong id="roomPlayers">0</strong>
                </div>
            </div>
            
            <button onclick="leaveGame()" class="btn btn-danger">
                <i class="fas fa-sign-out-alt"></i> –í–´–ô–¢–ò
            </button>
        </div>

        <!-- –≠–ö–†–ê–ù –í–û–ü–†–û–°–ê -->
        <div id="questionScreen" class="screen">
            <div class="question-header">
                <div style="color: #4facfe; font-weight: 600;">–•–ò–ú–ò–Ø</div>
                <div>–í–æ–ø—Ä–æ—Å <span id="currentQ">1</span>/30</div>
            </div>
            
            <div class="question-text" id="questionText">
                –¢–µ–∫—Å—Ç –≤–æ–ø—Ä–æ—Å–∞ –ø–æ—è–≤–∏—Ç—Å—è –∑–¥–µ—Å—å
            </div>
            
            <div class="options" id="optionsContainer">
                <!-- –í–∞—Ä–∏–∞–Ω—Ç—ã –∑–∞–≥—Ä—É–∑—è—Ç—Å—è —á–µ—Ä–µ–∑ JS -->
            </div>
            
            <div class="status" id="answerStatus">
                –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—Ä–∏–∞–Ω—Ç –æ—Ç–≤–µ—Ç–∞
            </div>
        </div>

        <!-- –≠–ö–†–ê–ù –†–ï–ó–£–õ–¨–¢–ê–¢–ê -->
        <div id="resultScreen" class="screen">
            <div class="header">
                <div class="logo">üìä</div>
                <h2>–†–ï–ó–£–õ–¨–¢–ê–¢</h2>
            </div>
            
            <div class="info-box" id="resultContent">
                –ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞...
            </div>
            
            <div class="status">
                –°–ª–µ–¥—É—é—â–∏–π –≤–æ–ø—Ä–æ—Å —Å–∫–æ—Ä–æ –Ω–∞—á–Ω–µ—Ç—Å—è
            </div>
        </div>
    </div>

    <!-- Firebase config -->
    <script src="firebase-config.js"></script>

    <script>
        // ============================================
        // –ü–†–û–°–¢–û–ô –ö–û–î –î–õ–Ø –£–ß–ï–ù–ò–ö–ê
        // ============================================

        let currentGameId = null;
        let playerName = null;
        let currentQuestion = null;
        let hasAnswered = false;
        let db = null;

        // –≠–õ–ï–ú–ï–ù–¢–´ DOM
        const joinScreen = document.getElementById('joinScreen');
        const waitingScreen = document.getElementById('waitingScreen');
        const questionScreen = document.getElementById('questionScreen');
        const resultScreen = document.getElementById('resultScreen');
        const joinButton = document.getElementById('joinButton');
        const errorContainer = document.getElementById('errorContainer');

        // –ü–û–ö–ê–ó–ê–¢–¨ –û–®–ò–ë–ö–£
        function showError(message) {
            errorContainer.innerHTML = `
                <div class="error">
                    <i class="fas fa-exclamation-triangle"></i> ${message}
                </div>
            `;
            setTimeout(() => { errorContainer.innerHTML = ''; }, 5000);
        }

        // –ü–ï–†–ï–ö–õ–Æ–ß–ò–¢–¨ –≠–ö–†–ê–ù
        function switchScreen(screenName) {
            [joinScreen, waitingScreen, questionScreen, resultScreen].forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenName + 'Screen').classList.add('active');
        }

        // –ü–û–î–ö–õ–Æ–ß–ò–¢–¨–°–Ø –ö –ò–ì–†–ï
        function joinGame() {
            const name = document.getElementById('playerName').value.trim();
            const code = document.getElementById('gameCode').value.trim();
            
            if (!name || name.length < 2) {
                showError("–í–≤–µ–¥–∏—Ç–µ –∏–º—è (–º–∏–Ω–∏–º—É–º 2 —Å–∏–º–≤–æ–ª–∞)");
                return;
            }
            
            if (!code || code.length !== 8 || !/^\d+$/.test(code)) {
                showError("–í–≤–µ–¥–∏—Ç–µ 8 —Ü–∏—Ñ—Ä –∫–æ–¥–∞ –≤–∏–∫—Ç–æ—Ä–∏–Ω—ã");
                return;
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º Firebase
            if (typeof firebase === 'undefined') {
                showError("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏. –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É.");
                return;
            }
            
            try {
                db = firebase.database();
            } catch (error) {
                showError("–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö");
                return;
            }
            
            playerName = name;
            currentGameId = "game_" + code;
            
            // –ú–µ–Ω—è–µ–º –∫–Ω–æ–ø–∫—É
            joinButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> –ü–û–î–ö–õ–Æ–ß–ï–ù–ò–ï...';
            joinButton.disabled = true;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –∏–≥—Ä—ã
            db.ref(`games/${currentGameId}`).once('value')
                .then(snapshot => {
                    if (!snapshot.exists()) {
                        throw new Error(`–í–∏–∫—Ç–æ—Ä–∏–Ω–∞ —Å –∫–æ–¥–æ–º ${code} –Ω–µ –Ω–∞–π–¥–µ–Ω–∞!`);
                    }
                    
                    const game = snapshot.val();
                    
                    if (game.status === "finished") {
                        throw new Error("–≠—Ç–∞ –≤–∏–∫—Ç–æ—Ä–∏–Ω–∞ —É–∂–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∞");
                    }
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å –∏–º–µ–Ω–∏
                    if (game.players && game.players[name]) {
                        throw new Error("–£—á–∞—Å—Ç–Ω–∏–∫ —Å —Ç–∞–∫–∏–º –∏–º–µ–Ω–µ–º —É–∂–µ –µ—Å—Ç—å!");
                    }
                    
                    // –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –∏–≥—Ä–æ–∫–∞
                    return db.ref(`games/${currentGameId}/players/${name}`).set({
                        name: name,
                        joined: Date.now(),
                        score: 0
                    });
                })
                .then(() => {
                    console.log("‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω –∫ –∏–≥—Ä–µ:", currentGameId);
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                    document.getElementById('displayName').textContent = name;
                    document.getElementById('displayCode').textContent = code;
                    
                    switchScreen('waiting');
                    
                    // –°–ª—É—à–∞–µ–º –∏–≥—Ä—É
                    listenToGame();
                    
                    // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫—É
                    joinButton.innerHTML = '<i class="fas fa-gamepad"></i> –ü–û–î–ö–õ–Æ–ß–ò–¢–¨–°–Ø';
                    joinButton.disabled = false;
                    
                })
                .catch(error => {
                    showError(error.message);
                    joinButton.innerHTML = '<i class="fas fa-gamepad"></i> –ü–û–î–ö–õ–Æ–ß–ò–¢–¨–°–Ø';
                    joinButton.disabled = false;
                });
        }

        // –°–õ–£–®–ê–¢–¨ –ò–ì–†–£
        function listenToGame() {
            if (!currentGameId || !db) return;
            
            // –°–ª—É—à–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∏–≥—Ä–µ
            db.ref(`games/${currentGameId}`).on('value', snapshot => {
                const game = snapshot.val();
                if (!game) {
                    console.log("–ò–≥—Ä–∞ —É–¥–∞–ª–µ–Ω–∞");
                    leaveGame();
                    return;
                }
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–≥—Ä–æ–∫–æ–≤
                const players = game.players || {};
                document.getElementById('roomPlayers').textContent = Object.keys(players).length;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç
                if (players[playerName]) {
                    document.getElementById('displayScore').textContent = players[playerName].score || 0;
                }
                
                // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Å—Ç–∞—Ç—É—Å –∏–≥—Ä—ã
                const currentQuestionId = game.currentQuestion;
                
                switch (game.status) {
                    case "lobby":
                    case "waiting":
                        // –ñ–¥–µ–º –≤ –ª–æ–±–±–∏
                        break;
                        
                    case "question_active":
                        if (currentQuestionId && (!currentQuestion || currentQuestion.id !== currentQuestionId)) {
                            handleQuestion(currentQuestionId);
                        }
                        break;
                        
                    case "showing_results":
                        if (currentQuestionId && !hasAnswered) {
                            hasAnswered = false;
                        }
                        showResults(currentQuestionId);
                        break;
                }
            });
        }

        // –û–ë–†–ê–ë–û–¢–ê–¢–¨ –í–û–ü–†–û–°
        function handleQuestion(questionId) {
            currentQuestion = QUIZ_DATA.questions.find(q => q.id === questionId);
            if (!currentQuestion) return;
            
            hasAnswered = false;
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤–æ–ø—Ä–æ—Å
            switchScreen('question');
            document.getElementById('currentQ').textContent = currentQuestion.id;
            document.getElementById('questionText').textContent = currentQuestion.text;
            
            // –û—á–∏—â–∞–µ–º —Å—Ç–∞—Ç—É—Å
            document.getElementById('answerStatus').textContent = "–í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—Ä–∏–∞–Ω—Ç –æ—Ç–≤–µ—Ç–∞";
            document.getElementById('answerStatus').className = "status";
            
            // –°–æ–∑–¥–∞–µ–º –≤–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–≤–µ—Ç–æ–≤
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            
            currentQuestion.options.forEach((option, index) => {
                const optionDiv = document.createElement('div');
                optionDiv.className = 'option';
                optionDiv.innerHTML = `
                    <div class="option-letter">${String.fromCharCode(65 + index)}</div>
                    <div>${option}</div>
                `;
                
                optionDiv.onclick = () => selectAnswer(index);
                optionsContainer.appendChild(optionDiv);
            });
        }

        // –í–´–ë–†–ê–¢–¨ –û–¢–í–ï–¢
        function selectAnswer(answerIndex) {
            if (hasAnswered || !currentQuestion || !currentGameId || !playerName || !db) return;
            
            hasAnswered = true;
            
            // –û—Ç–º–µ—á–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç
            document.querySelectorAll('.option').forEach((opt, idx) => {
                opt.classList.remove('selected');
                if (idx === answerIndex) {
                    opt.classList.add('selected');
                }
            });
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å
            const isCorrect = (answerIndex === currentQuestion.correct);
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ—Ç–≤–µ—Ç
            db.ref(`games/${currentGameId}/answers/${currentQuestion.id}/${playerName}`).set({
                answerIndex: answerIndex,
                isCorrect: isCorrect,
                timestamp: Date.now()
            }).then(() => {
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç –µ—Å–ª–∏ –æ—Ç–≤–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
                if (isCorrect) {
                    db.ref(`games/${currentGameId}/players/${playerName}/score`).transaction(score => {
                        return (score || 0) + (currentQuestion.points || 1);
                    });
                }
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞—Ç—É—Å
                const status = document.getElementById('answerStatus');
                status.textContent = isCorrect ? "‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ!" : "‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ";
                status.className = isCorrect ? "status correct" : "status wrong";
                
            }).catch(error => {
                console.error("–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –æ—Ç–≤–µ—Ç–∞:", error);
            });
        }

        // –ü–û–ö–ê–ó–ê–¢–¨ –†–ï–ó–£–õ–¨–¢–ê–¢–´
        function showResults(questionId) {
            const question = QUIZ_DATA.questions.find(q => q.id === questionId);
            if (!question) return;
            
            switchScreen('result');
            
            // –ü–æ–ª—É—á–∞–µ–º –æ—Ç–≤–µ—Ç—ã –Ω–∞ —ç—Ç–æ—Ç –≤–æ–ø—Ä–æ—Å
            db.ref(`games/${currentGameId}/answers/${questionId}`).once('value')
                .then(snapshot => {
                    const answers = snapshot.val() || {};
                    const playerAnswer = answers[playerName];
                    
                    let resultHTML = '';
                    
                    if (playerAnswer) {
                        const isCorrect = playerAnswer.isCorrect;
                        const points = isCorrect ? question.points || 1 : 0;
                        
                        resultHTML = `
                            <div style="text-align: center; margin-bottom: 20px;">
                                <div style="font-size: 2rem; margin-bottom: 10px;">
                                    ${isCorrect ? '‚úÖ' : '‚ùå'}
                                </div>
                                <div style="color: ${isCorrect ? '#2e8b57' : '#dc3545'}; font-size: 1.3rem; margin-bottom: 10px;">
                                    ${isCorrect ? '–ü–†–ê–í–ò–õ–¨–ù–û!' : '–ù–ï–ü–†–ê–í–ò–õ–¨–ù–û'}
                                </div>
                                <div style="font-size: 1.1rem; margin-bottom: 15px;">
                                    ${points} ${points === 1 ? '–æ—á–∫–æ' : points < 5 ? '–æ—á–∫–∞' : '–æ—á–∫–æ–≤'}
                                </div>
                            </div>
                            <div style="background: #1a1a2e; padding: 15px; border-radius: 8px; margin-top: 15px;">
                                <div style="color: #4facfe; margin-bottom: 10px;">üìù –û–±—ä—è—Å–Ω–µ–Ω–∏–µ:</div>
                                <div>${question.explanation}</div>
                            </div>
                        `;
                    } else {
                        resultHTML = `
                            <div style="text-align: center;">
                                <div style="font-size: 2rem; margin-bottom: 15px;">‚è∞</div>
                                <div style="color: #a0a0c0;">–í—ã –Ω–µ —É—Å–ø–µ–ª–∏ –æ—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ —ç—Ç–æ—Ç –≤–æ–ø—Ä–æ—Å</div>
                            </div>
                        `;
                    }
                    
                    document.getElementById('resultContent').innerHTML = resultHTML;
                });
        }

        // –í–´–ô–¢–ò –ò–ó –ò–ì–†–´
        function leaveGame() {
            if (currentGameId && playerName && db) {
                db.ref(`games/${currentGameId}/players/${playerName}`).remove();
            }
            
            currentGameId = null;
            playerName = null;
            currentQuestion = null;
            hasAnswered = false;
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–æ—Ä–º—É
            document.getElementById('playerName').value = '';
            document.getElementById('gameCode').value = '';
            
            switchScreen('join');
        }

        // –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò –°–û–ë–´–¢–ò–ô
        document.addEventListener('DOMContentLoaded', function() {
            console.log("–°—Ç—Ä–∞–Ω–∏—Ü–∞ —É—á–µ–Ω–∏–∫–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞");
            
            // –§–æ–∫—É—Å –Ω–∞ –ø–æ–ª–µ –∏–º–µ–Ω–∏
            setTimeout(() => {
                document.getElementById('playerName').focus();
            }, 300);
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
            joinButton.addEventListener('click', joinGame);
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ Enter
            document.getElementById('playerName').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    document.getElementById('gameCode').focus();
                }
            });
            
            document.getElementById('gameCode').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    joinGame();
                }
            });
            
            // –í–∞–ª–∏–¥–∞—Ü–∏—è –≤–≤–æ–¥–∞ –∫–æ–¥–∞
            document.getElementById('gameCode').addEventListener('input', function() {
                this.value = this.value.replace(/\D/g, '').substring(0, 8);
            });
        });

        // –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º —Ñ—É–Ω–∫—Ü–∏–∏
        window.joinGame = joinGame;
        window.leaveGame = leaveGame;
        window.selectAnswer = selectAnswer;
    </script>
</body>
</html>
